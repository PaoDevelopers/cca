{{ define "title" }}
Courses
{{ end }}

{{ define "head" }}
<script defer src="/admin/static/search.js"></script>
{{ end }}

{{ define "content" }}
{{ $data := . }}
<section class="intro">
<p>
Courses represent the offerings that students may select.
Each course belongs to a single period and category, and
includes details such as capacity, membership type, and location.
</p>
</section>
<section class="listing">
<h2>Current courses</h2>
<div>
<input type="text" id="search-bar" placeholder="Search..." class="search-bar">
</div>
<div class="cards-grid">
{{ range $data.Courses }}
{{ $course := . }}
<article class="card">
<header class="card-header hfill"><span>{{ $course.Name }}</span><span>{{ $course.ID }}</span></header>
<div class="hfill"><span>{{ $course.Period }}</span><span>{{ $course.CategoryID }}</span></div>
<div class="hfill"><span>{{ $course.Teacher }} @ {{ $course.Location }}</span><span><!--TODO: current count--> /{{ $course.MaxStudents }}</span></div>
{{ if $course.Description }}
<p>
{{ $course.Description }}
</p>
{{ end }}
<details>
<summary>Actions</summary>
<form method="POST" action="/admin/courses/edit" class="stack-form">
<input type="hidden" name="id" value="{{ $course.ID }}" />
<div class="form-field">
<label for="name-{{ $course.ID }}">Name</label>
<input type="text" id="name-{{ $course.ID }}" name="name" value="{{ $course.Name }}" required />
</div>
<div class="form-field">
<label for="description-{{ $course.ID }}">Description</label>
<textarea id="description-{{ $course.ID }}" name="description" rows="3">{{ $course.Description }}</textarea>
</div>
<div class="form-field">
<label for="period-{{ $course.ID }}">Period</label>
<select id="period-{{ $course.ID }}" name="period" required>
{{ range $data.Periods }}
<option value="{{ . }}" {{ if eq . $course.Period }}selected{{ end }}>{{ . }}</option>
{{ end }}
</select>
</div>
<div class="form-field">
<label for="max-students-{{ $course.ID }}">Max students</label>
<input type="number" id="max-students-{{ $course.ID }}" name="max_students" min="0" step="1" value="{{ $course.MaxStudents }}" required />
</div>
<div class="form-field">
<label for="membership-{{ $course.ID }}">Membership</label>
<select id="membership-{{ $course.ID }}" name="membership" required>
{{ range $data.Memberships }}
<option value="{{ . }}" {{ if eq . $course.Membership }}selected{{ end }}>{{ . }}</option>
{{ end }}
</select>
</div>
<div class="form-field">
<label for="teacher-{{ $course.ID }}">Teacher</label>
<input type="text" id="teacher-{{ $course.ID }}" name="teacher" value="{{ $course.Teacher }}" required />
</div>
<div class="form-field">
<label for="location-{{ $course.ID }}">Location</label>
<input type="text" id="location-{{ $course.ID }}" name="location" value="{{ $course.Location }}" required />
</div>
<div class="form-field">
<label for="category-{{ $course.ID }}">Category</label>
<select id="category-{{ $course.ID }}" name="category_id" required>
{{ range $data.Categories }}
<option value="{{ . }}" {{ if eq . $course.CategoryID }}selected{{ end }}>{{ . }}</option>
{{ end }}
</select>
</div>
<div class="form-actions">
<button type="submit">Save</button>
</div>
</form>
<form method="POST" action="/admin/courses/delete" class="stack-form">
<input type="hidden" name="id" value="{{ $course.ID }}" />
<div class="form-actions">
<button type="submit">Delete</button>
</div>
</form>
</details>
</article>
{{ end }}
</div>
</section>
<section class="new">
<h2>New course</h2>
<form method="POST" action="/admin/courses/new" class="stack-form">
<div class="form-field">
<label for="new-course-id">ID</label>
<input type="text" id="new-course-id" name="id" required />
</div>
<div class="form-field">
<label for="new-course-name">Name</label>
<input type="text" id="new-course-name" name="name" required />
</div>
<div class="form-field">
<label for="new-course-description">Description</label>
<textarea id="new-course-description" name="description" rows="3"></textarea>
</div>
<div class="form-field">
<label for="new-course-period">Period</label>
<select id="new-course-period" name="period" required>
{{ range $data.Periods }}
<option value="{{ . }}">{{ . }}</option>
{{ end }}
</select>
</div>
<div class="form-field">
<label for="new-course-max-students">Max students</label>
<input type="number" id="new-course-max-students" name="max_students" min="0" step="1" required />
</div>
<div class="form-field">
<label for="new-course-membership">Membership</label>
<select id="new-course-membership" name="membership" required>
{{ range $data.Memberships }}
<option value="{{ . }}">{{ . }}</option>
{{ end }}
</select>
</div>
<div class="form-field">
<label for="new-course-teacher">Teacher</label>
<input type="text" id="new-course-teacher" name="teacher" required />
</div>
<div class="form-field">
<label for="new-course-location">Location</label>
<input type="text" id="new-course-location" name="location" required />
</div>
<div class="form-field">
<label for="new-course-category">Category</label>
<select id="new-course-category" name="category_id" required>
{{ range $data.Categories }}
<option value="{{ . }}">{{ . }}</option>
{{ end }}
</select>
</div>
<fieldset class="form-field checkbox-group">
<legend>Allowed legal sexes</legend>
{{ range $data.LegalSexes }}
<div class="checkbox-option">
<input type="checkbox" id="new-course-legal-sex-{{ . }}" name="legal_sexes" value="{{ . }}" />
<label for="new-course-legal-sex-{{ . }}">{{ . }}</label>
</div>
{{ end }}
<p class="form-note">Leave all unchecked to allow all legal sexes.</p>
</fieldset>
<fieldset class="form-field checkbox-group">
<legend>Allowed grades</legend>
{{ range $data.Grades }}
<div class="checkbox-option">
<input type="checkbox" id="new-course-grade-{{ .Grade }}" name="allowed_grades" value="{{ .Grade }}" />
<label for="new-course-grade-{{ .Grade }}">{{ .Grade }}</label>
</div>
{{ end }}
<p class="form-note">Leave all unchecked to allow all grades.</p>
</fieldset>
<div class="form-actions">
<button type="submit">Add</button>
</div>
</form>
</section>
<section class="import">
<h2>Import CSV</h2>
<p>
Upload a CSV to bulk-create courses. Fields must appear in the following order:
<code>id</code>,
<code>name</code>,
<code>description</code>,
<code>period</code>,
<code>max_students</code>,
<code>membership</code>,
<code>teacher</code>,
<code>location</code>,
<code>category_id</code>,
<code>allowed_legal_sexes</code>,
<code>allowed_grades</code>.
Use comma-separated lists inside the legal sex and grade columns (e.g. <code>"F,M"</code> or <code>"Year 9,Year 10"</code>).
</p>
<p>
Download an example file: <a href="/admin/static/courses_example.csv">courses_example.csv</a>
</p>
<form method="POST" action="/admin/courses/import" enctype="multipart/form-data" class="stack-form">
<div class="form-field">
<label for="courses-import-csv">CSV file</label>
<input type="file" id="courses-import-csv" name="csv" accept=".csv" required />
</div>
<div class="form-actions">
<button type="submit">Import</button>
</div>
</form>
</section>
{{ end }}
